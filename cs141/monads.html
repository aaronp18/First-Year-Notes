<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Monads - Computer Systems Engineering Notes</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item "><a href="../cs118/index.html"><strong aria-hidden="true">1.</strong> CS118</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs118/floats.html"><strong aria-hidden="true">1.1.</strong> IEEE 754</a></li><li class="chapter-item "><a href="../cs118/oop.html"><strong aria-hidden="true">1.2.</strong> OOP Principles</a></li><li class="chapter-item "><a href="../cs118/exceptions.html"><strong aria-hidden="true">1.3.</strong> Java Exceptions & Generics</a></li></ol></li><li class="chapter-item "><a href="../cs126/index.html"><strong aria-hidden="true">2.</strong> CS126</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs126/arrays.html"><strong aria-hidden="true">2.1.</strong> Arrays & Linked Lists</a></li><li class="chapter-item "><a href="../cs126/analysis.html"><strong aria-hidden="true">2.2.</strong> Analysis of Algorithms</a></li><li class="chapter-item "><a href="../cs126/recursion.html"><strong aria-hidden="true">2.3.</strong> Recursive Algorithms</a></li><li class="chapter-item "><a href="../cs126/stacks.html"><strong aria-hidden="true">2.4.</strong> Stacks & Queues</a></li><li class="chapter-item "><a href="../cs126/lists.html"><strong aria-hidden="true">2.5.</strong> Lists</a></li><li class="chapter-item "><a href="../cs126/maps.html"><strong aria-hidden="true">2.6.</strong> Maps</a></li><li class="chapter-item "><a href="../cs126/hash.html"><strong aria-hidden="true">2.7.</strong> Hash Tables</a></li><li class="chapter-item "><a href="../cs126/sets.html"><strong aria-hidden="true">2.8.</strong> Sets</a></li><li class="chapter-item "><a href="../cs126/trees.html"><strong aria-hidden="true">2.9.</strong> Trees</a></li><li class="chapter-item "><a href="../cs126/pqs.html"><strong aria-hidden="true">2.10.</strong> Priority Queues</a></li><li class="chapter-item "><a href="../cs126/heaps.html"><strong aria-hidden="true">2.11.</strong> Heaps</a></li><li class="chapter-item "><a href="../cs126/skip-lists.html"><strong aria-hidden="true">2.12.</strong> Skip Lists</a></li><li class="chapter-item "><a href="../cs126/graphs.html"><strong aria-hidden="true">2.13.</strong> Graphs</a></li></ol></li><li class="chapter-item "><a href="../cs132/index.html"><strong aria-hidden="true">3.</strong> CS132</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs132/logic.html"><strong aria-hidden="true">3.1.</strong> Digital Logic</a></li><li class="chapter-item "><a href="../cs132/assembly.html"><strong aria-hidden="true">3.2.</strong> Assembly</a></li><li class="chapter-item "><a href="../cs132/memory.html"><strong aria-hidden="true">3.3.</strong> Memory Systems</a></li><li class="chapter-item "><a href="../cs132/io.html"><strong aria-hidden="true">3.4.</strong> I/O</a></li><li class="chapter-item "><a href="../cs132/architecture.html"><strong aria-hidden="true">3.5.</strong> Microprocessor Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="../cs141/index.html"><strong aria-hidden="true">4.</strong> CS141</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs141/types.html"><strong aria-hidden="true">4.1.</strong> Types & Typeclasses</a></li><li class="chapter-item "><a href="../cs141/recursion.html"><strong aria-hidden="true">4.2.</strong> Recursion</a></li><li class="chapter-item "><a href="../cs141/functions.html"><strong aria-hidden="true">4.3.</strong> Higher Order Functions</a></li><li class="chapter-item "><a href="../cs141/lazy.html"><strong aria-hidden="true">4.4.</strong> Lazy Evaluation</a></li><li class="chapter-item "><a href="../cs141/reasoning.html"><strong aria-hidden="true">4.5.</strong> Reasoning About Programs</a></li><li class="chapter-item "><a href="../cs141/functors.html"><strong aria-hidden="true">4.6.</strong> Functors & Foldables</a></li><li class="chapter-item "><a href="../cs141/applicatives.html"><strong aria-hidden="true">4.7.</strong> Applicative Functors</a></li><li class="chapter-item expanded "><a href="../cs141/monads.html" class="active"><strong aria-hidden="true">4.8.</strong> Monads</a></li><li class="chapter-item "><a href="../cs141/tlp.html"><strong aria-hidden="true">4.9.</strong> Type-Level Programming</a></li></ol></li><li class="chapter-item "><a href="../es191/index.html"><strong aria-hidden="true">5.</strong> ES191</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es191/symbols-and-conventions.html"><strong aria-hidden="true">5.1.</strong> Circuit Symbols & Conventions</a></li><li class="chapter-item "><a href="../es191/nodal.html"><strong aria-hidden="true">5.2.</strong> Nodal Analysis</a></li><li class="chapter-item "><a href="../es191/mesh.html"><strong aria-hidden="true">5.3.</strong> Mesh Analysis</a></li><li class="chapter-item "><a href="../es191/thevenin.html"><strong aria-hidden="true">5.4.</strong> Thevenin Circuits</a></li><li class="chapter-item "><a href="../es191/rc.html"><strong aria-hidden="true">5.5.</strong> First Order RC Circuits</a></li><li class="chapter-item "><a href="../es191/rl.html"><strong aria-hidden="true">5.6.</strong> First Order RL Circuits</a></li><li class="chapter-item "><a href="../es191/ac.html"><strong aria-hidden="true">5.7.</strong> AC Circuits</a></li><li class="chapter-item "><a href="../es191/diodes.html"><strong aria-hidden="true">5.8.</strong> Diodes</a></li><li class="chapter-item "><a href="../es191/transistors.html"><strong aria-hidden="true">5.9.</strong> Transistors</a></li><li class="chapter-item "><a href="../es191/opamps.html"><strong aria-hidden="true">5.10.</strong> Op Amps</a></li><li class="chapter-item "><a href="../es191/filters.html"><strong aria-hidden="true">5.11.</strong> Passive Filters</a></li><li class="chapter-item "><a href="../es191/equations.html"><strong aria-hidden="true">5.12.</strong> Equation Reference</a></li></ol></li><li class="chapter-item "><a href="../es193/index.html"><strong aria-hidden="true">6.</strong> ES193</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es193/functions.html"><strong aria-hidden="true">6.1.</strong> Functions, Conics & Asymptotes</a></li><li class="chapter-item "><a href="../es193/complex.html"><strong aria-hidden="true">6.2.</strong> Complex Numbers</a></li><li class="chapter-item "><a href="../es193/vectors.html"><strong aria-hidden="true">6.3.</strong> Vectors</a></li><li class="chapter-item "><a href="../es193/matrices.html"><strong aria-hidden="true">6.4.</strong> Matrices</a></li><li class="chapter-item "><a href="../es193/equations.html"><strong aria-hidden="true">6.5.</strong> Simultaneous Linear Equations</a></li><li class="chapter-item "><a href="../es193/diff.html"><strong aria-hidden="true">6.6.</strong> Differentiation</a></li><li class="chapter-item "><a href="../es193/int.html"><strong aria-hidden="true">6.7.</strong> Integration</a></li><li class="chapter-item "><a href="../es193/diffeq.html"><strong aria-hidden="true">6.8.</strong> Differential Equations</a></li><li class="chapter-item "><a href="../es193/laplace.html"><strong aria-hidden="true">6.9.</strong> Laplace Transforms</a></li><li class="chapter-item "><a href="../es193/stats.html"><strong aria-hidden="true">6.10.</strong> Probability & Statistics</a></li><li class="chapter-item "><a href="../es193/equationref.html"><strong aria-hidden="true">6.11.</strong> Equation Reference</a></li></ol></li><li class="chapter-item "><a href="../es197/index.html"><strong aria-hidden="true">7.</strong> ES197</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es197/mech1.html"><strong aria-hidden="true">7.1.</strong> Translational Mechanical Systems</a></li><li class="chapter-item "><a href="../es197/mech2.html"><strong aria-hidden="true">7.2.</strong> Rotational Mechanical Systems</a></li><li class="chapter-item "><a href="../es197/electrical.html"><strong aria-hidden="true">7.3.</strong> Electrical Systems</a></li><li class="chapter-item "><a href="../es197/thermal.html"><strong aria-hidden="true">7.4.</strong> Thermal Systems</a></li><li class="chapter-item "><a href="../es197/data.html"><strong aria-hidden="true">7.5.</strong> Data Driven Models</a></li><li class="chapter-item "><a href="../es197/step1.html"><strong aria-hidden="true">7.6.</strong> First Order Step Response</a></li><li class="chapter-item "><a href="../es197/step2.html"><strong aria-hidden="true">7.7.</strong> Second Order Step Response</a></li><li class="chapter-item "><a href="../es197/transfer.html"><strong aria-hidden="true">7.8.</strong> Transfer Functions</a></li><li class="chapter-item "><a href="../es197/freq1.html"><strong aria-hidden="true">7.9.</strong> First Order Frequency Response</a></li><li class="chapter-item "><a href="../es197/freq2.html"><strong aria-hidden="true">7.10.</strong> Second Order Frequency Response</a></li></ol></li><li class="chapter-item "><a href="../cs241/index.html"><strong aria-hidden="true">8.</strong> CS241</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs241/os.html"><strong aria-hidden="true">8.1.</strong> Operating Systems</a></li><li class="chapter-item "><a href="../cs241/cn.html"><strong aria-hidden="true">8.2.</strong> Networks</a></li></ol></li><li class="chapter-item "><a href="../cs257/index.html"><strong aria-hidden="true">9.</strong> CS257</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs257/memory.html"><strong aria-hidden="true">9.1.</strong> Memory Systems</a></li><li class="chapter-item "><a href="../cs257/architecture.html"><strong aria-hidden="true">9.2.</strong> Processor Architecture</a></li><li class="chapter-item "><a href="../cs257/parallelism.html"><strong aria-hidden="true">9.3.</strong> Parallelism</a></li><li class="chapter-item "><a href="../cs257/io.html"><strong aria-hidden="true">9.4.</strong> I/O</a></li><li class="chapter-item "><a href="../cs257/embedded.html"><strong aria-hidden="true">9.5.</strong> Embedded Systems & Security</a></li></ol></li><li class="chapter-item "><a href="../cs261/index.html"><strong aria-hidden="true">10.</strong> CS261</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs261/management.html"><strong aria-hidden="true">10.1.</strong> Project Management</a></li><li class="chapter-item "><a href="../cs261/design.html"><strong aria-hidden="true">10.2.</strong> System Design & Implementation</a></li><li class="chapter-item "><a href="../cs261/hci.html"><strong aria-hidden="true">10.3.</strong> Human Computer Interaction</a></li><li class="chapter-item "><a href="../cs261/testing.html"><strong aria-hidden="true">10.4.</strong> Testing</a></li></ol></li><li class="chapter-item "><a href="../es2c0/index.html"><strong aria-hidden="true">11.</strong> ES2C0</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2c0/diodes.html"><strong aria-hidden="true">11.1.</strong> Diodes</a></li><li class="chapter-item "><a href="../es2c0/oscillators.html"><strong aria-hidden="true">11.2.</strong> Oscillators</a></li><li class="chapter-item "><a href="../es2c0/bjt.html"><strong aria-hidden="true">11.3.</strong> BJTs</a></li><li class="chapter-item "><a href="../es2c0/bjt-amps.html"><strong aria-hidden="true">11.4.</strong> BJT Amplifiers</a></li><li class="chapter-item "><a href="../es2c0/mosfet.html"><strong aria-hidden="true">11.5.</strong> MOSFETs</a></li><li class="chapter-item "><a href="../es2c0/mosfet-amps.html"><strong aria-hidden="true">11.6.</strong> MOSFET Amplifiers</a></li><li class="chapter-item "><a href="../es2c0/differential.html"><strong aria-hidden="true">11.7.</strong> Differential Amplifiers</a></li><li class="chapter-item "><a href="../es2c0/opamps.html"><strong aria-hidden="true">11.8.</strong> Op-Amp Circuits</a></li></ol></li><li class="chapter-item "><a href="../es2c6/index.html"><strong aria-hidden="true">12.</strong> ES2C6</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2c6/control.html"><strong aria-hidden="true">12.1.</strong> Control Systems</a></li><li class="chapter-item "><a href="../es2c6/mechanics.html"><strong aria-hidden="true">12.2.</strong> Drive Systems</a></li><li class="chapter-item "><a href="../es2c6/sensors.html"><strong aria-hidden="true">12.3.</strong> Sensors</a></li><li class="chapter-item "><a href="../es2c6/electromagnetics.html"><strong aria-hidden="true">12.4.</strong> Electromagnetics & Motors</a></li><li class="chapter-item "><a href="../es2c6/ac.html"><strong aria-hidden="true">12.5.</strong> AC Power</a></li><li class="chapter-item "><a href="../es2c6/3phase.html"><strong aria-hidden="true">12.6.</strong> Three Phase AC Systems</a></li></ol></li><li class="chapter-item "><a href="../es2c7/index.html"><strong aria-hidden="true">13.</strong> ES2C7</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2c7/binomial.html"><strong aria-hidden="true">13.1.</strong> Binomial Theorem & Taylor Series</a></li><li class="chapter-item "><a href="../es2c7/matrices.html"><strong aria-hidden="true">13.2.</strong> Matrices & Quadratic Forms</a></li><li class="chapter-item "><a href="../es2c7/equations.html"><strong aria-hidden="true">13.3.</strong> Linear Simultaneous Equations</a></li><li class="chapter-item "><a href="../es2c7/eigen.html"><strong aria-hidden="true">13.4.</strong> Eigenvalues & Eigenvectors</a></li><li class="chapter-item "><a href="../es2c7/systems.html"><strong aria-hidden="true">13.5.</strong> Oscillators & State Space Systems</a></li><li class="chapter-item "><a href="../es2c7/calculus.html"><strong aria-hidden="true">13.6.</strong> Matrix Differential Calculus</a></li><li class="chapter-item "><a href="../es2c7/optimisation.html"><strong aria-hidden="true">13.7.</strong> Optimisation</a></li><li class="chapter-item "><a href="../es2c7/fourier.html"><strong aria-hidden="true">13.8.</strong> Fourier Series & Transforms</a></li><li class="chapter-item "><a href="../es2c7/z.html"><strong aria-hidden="true">13.9.</strong> Z Transforms</a></li><li class="chapter-item "><a href="../es2c7/pdes.html"><strong aria-hidden="true">13.10.</strong> Partial Differential Equations</a></li></ol></li><li class="chapter-item "><a href="../es2e3/index.html"><strong aria-hidden="true">14.</strong> ES2E3</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2e3/logic.html"><strong aria-hidden="true">14.1.</strong> Logic</a></li><li class="chapter-item "><a href="../es2e3/hdl.html"><strong aria-hidden="true">14.2.</strong> Hardware Description Languages</a></li><li class="chapter-item "><a href="../es2e3/verilog.html"><strong aria-hidden="true">14.3.</strong> Structural & Behavioual Verilog</a></li><li class="chapter-item "><a href="../es2e3/design.html"><strong aria-hidden="true">14.4.</strong> FPGA Design Flow</a></li><li class="chapter-item "><a href="../es2e3/architecture.html"><strong aria-hidden="true">14.5.</strong> FPGA Architecture</a></li><li class="chapter-item "><a href="../es2e3/sequential.html"><strong aria-hidden="true">14.6.</strong> Sequential Verilog</a></li><li class="chapter-item "><a href="../es2e3/fsm.html"><strong aria-hidden="true">14.7.</strong> Finite State Machines</a></li><li class="chapter-item "><a href="../es2e3/verification.html"><strong aria-hidden="true">14.8.</strong> Verification</a></li><li class="chapter-item "><a href="../es2e3/arithmetic.html"><strong aria-hidden="true">14.9.</strong> FPGA Arithmetic</a></li><li class="chapter-item "><a href="../es2e3/timing.html"><strong aria-hidden="true">14.10.</strong> Timing & Pipelining</a></li><li class="chapter-item "><a href="../es2e3/interfaces.html"><strong aria-hidden="true">14.11.</strong> Hardware Interfaces</a></li><li class="chapter-item "><a href="../es2e3/processors.html"><strong aria-hidden="true">14.12.</strong> Processor Implementation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Computer Systems Engineering Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Joeyh021/notes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="monads"><a class="header" href="#monads">Monads</a></h1>
<p><strong>ṱ̴̹͙̗̣̙ͮ͆͑̊̅h̸̢͔͍̘̭͍̞̹̀ͣ̅͢e̖̠ͫ̒ͦ̅̉̓̓́͟͞ ͑ͥ̌̀̉̐̂͏͚̤͜f͚͔͖̠̣͚ͤ͆ͦ͂͆̄ͥ͌o̶̡̡̝͎͎̥͖̰̭̠̊r̗̯͈̀̚b̢͙̺͚̅͝i̸̡̱̯͔̠̲̿dͧ̈ͭ̑҉͎̮d̆̓̂̏̉̏͌͆̚͝͏̺͓̜̪͓e̎ͯͨ͢҉͙̠͕͍͉n͇̼̞̙͕̮̣͈͓ͨ͐͛̽ͣ̏͆́̓ ̵ͧ̏ͤ͋̌̒͘҉̞̞̱̲͓k͔̂ͪͦ́̀͗͘n͇̰͖̓ͦ͂̇̂͌̐ȯ̸̥͔̩͒̋͂̿͌w̞̟͔̙͇̾͋̅̅̔ͅlͧ͏͎̣̲̖̥ẻ̴̢̢͎̻̹̑͂̆̽ͮ̓͋d̴̪͉̜͓̗̈ͭ̓ͥͥ͞g͊̾̋̊͊̓͑҉͏̭͇̝̰̲̤̫̥e͈̝̖̖̾ͬ̍͢͞</strong></p>
<p>Monads are another level of abstraction on top of applicatives, and allow for much more flexible and expressive computation. Functors =&gt; Applicatives =&gt; Monads form a hierarchy of abstractions.</p>
<h2 id="the-monad-typeclass"><a class="header" href="#the-monad-typeclass">The <code>Monad</code> typeclass</a></h2>
<pre><code class="language-haskell">class Applicative m =&gt; Monad m where
  (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b

  return :: a -&gt; m a
  return = pure
</code></pre>
<p>The <code>&gt;&gt;=</code> operator is called <em>bind</em>, and applies a function that returns a wrapped value, to another wrapped value.</p>
<ul>
<li>The left operand is some monad containing a value <code>a</code></li>
<li>the right operand is a function of type <code>a -&gt; m b</code>, ie it takes some <code>a</code> and returns a monad containing something of type <code>b</code></li>
<li>The result is a monad of type <code>b</code></li>
</ul>
<p>The operator can essentially be thought of as feeding the wrapped value into the function, to get a new wrapped value. <code>x &gt;&gt;= f</code> unwraps the value in <code>x</code> from it, and applies the function to <code>f</code> to it. Understanding bind is key to understanding monads.</p>
<p><code>return</code> is just the same as <code>pure</code> for applicatives, lifting the value <code>a</code> into some monadic context.</p>
<p>Some example monad instances:</p>
<pre><code class="language-haskell">instance Monad Maybe where
  Nothing &gt;&gt;= _ = Nothing
  Just x  &gt;&gt;= f = f x

instance Monad (Either e) where
  Left l &gt;&gt;= _ = Left l
  Right r &gt;&gt;= f = f r

  pure = Right

instance Monad [] where
  xs &gt;&gt;= f = concat (map f xs)
</code></pre>
<p>Monads give effects: composing computations sequentially using <code>&gt;&gt;=</code> has an effect. With the <code>State</code> Monad this effect is &quot;mutation&quot;. With <code>Maybe</code> and <code>Either</code> the effect is that we may raise a failure at any step. Effects only happen when we want them, implemented by pure functions.</p>
<h2 id="monad-laws"><a class="header" href="#monad-laws">Monad Laws</a></h2>
<p>For a type to be a monad, it must satisfy the following laws:</p>
<ul>
<li><code>return a &gt;&gt;= h = h a</code>
<ul>
<li>Left identity</li>
</ul>
</li>
<li><code>m &gt;&gt;= return = m</code>
<ul>
<li>Right identity</li>
</ul>
</li>
<li><code>(m &gt;&gt;= f) &gt;&gt;= g = m &gt;&gt;= (\x -&gt; f x &gt;&gt;= g)</code>
<ul>
<li>Associativity</li>
</ul>
</li>
</ul>
<h2 id="example-evaluating-an-expression"><a class="header" href="#example-evaluating-an-expression">Example: Evaluating an Expression</a></h2>
<p>A type <code>Expr</code> is shown below that represents a mathematical expression, and an <code>eval</code> function to evaluate it. Note that it is actually unsafe and could crash at runtime due to a div by 0 error. The <code>safediv</code> function does this using <code>Maybe</code>.</p>
<pre><code class="language-haskell">data Expr = Val Int | Add Expr Expr | Div Expr Expr

eval :: Expr -&gt; Int
eval (Val n)   = n
eval (Add l r) = eval l + eval r
eval (Div l r) = eval l `div` eval r

safediv :: Int -&gt; Int -&gt; Maybe Int
safediv x 0 = Nothing
safediv x y = Just (x `div` y)
</code></pre>
<p>If we want to use <code>safediv</code> with <code>eval</code>, we need to change it's type signature. The updated <code>eval</code> is shown below using applicatives to write the function cleanly and propagate any errors:</p>
<pre><code class="language-haskell">eval :: Expr -&gt; Maybe Int
eval (Val n) = Just n
eval (Add l r) = (+) &lt;$&gt; eval l &lt;*&gt; eval r
eval (Div l r) = safediv &lt;$&gt; eval l &lt;*&gt; eval r
</code></pre>
<p>If any recursive calls return a <code>Nothing</code>, the entire expression will evaluate to <code>Nothing</code>. Otherwise, the <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> will evaluate the expression within the <code>Maybe</code> context. However, this is still wrong as the last expression now has type of <code>Maybe (Maybe Int)</code>. This can be fixed using <code>&gt;&gt;=</code>. Note the use of lambdas.</p>
<pre><code class="language-haskell">eval (Div l r) = eval l &gt;&gt;= \x -&gt;
                 eval r &gt;&gt;= \y -&gt;
                 x `safediv` y
</code></pre>
<p>The <code>Expr</code> type can be extended to include a conditional expression, where If Condition True False`.</p>
<pre><code class="language-haskell">data Expr = Val Int
          | Add Expr Expr
          | Div Expr Expr
          | If Expr Expr Expr

eval :: Expr -&gt; Maybe Int
eval (Val n)    = Just n
eval (Add l r)  = eval l &gt;&gt;= \x -&gt;
                  eval r &gt;&gt;= \y -&gt;
                  Just (x+y)
eval (Div l r)  = eval l &gt;&gt;= \x -&gt;
                  eval r &gt;&gt;= \y -&gt;
                  x `safediv` y
eval (If c t f) = ifA &lt;$&gt; eval c &lt;*&gt; eval t &lt;*&gt; eval f
  where ifA b x y = if b /= 0 then x else y
</code></pre>
<p>With this definition using applicatives, both branches of the conditional branch are evaluated. If there is an error in the false branch, the whole expression will fail. Here, using bind, the semantics are correct.</p>
<pre><code class="language-haskell">eval' (If c t f) = eval' c &gt;&gt;= \b -&gt;
    if b /= 0 then eval t else eval f
</code></pre>
<h2 id="-vs-"><a class="header" href="#-vs-"><code>&lt;*&gt;</code> vs <code>&gt;&gt;=</code></a></h2>
<p>Bind is a much more powerful abstraction than apply:</p>
<pre><code class="language-haskell">&lt;*&gt;  :: m (a -&gt; b) -&gt; m a -&gt; m b
(&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b
</code></pre>
<ul>
<li>Apply operates on functions already inside a context
<ul>
<li>This function can't determine anything to do with the context</li>
<li>With a <code>Maybe</code>, it can't determine if the overall expression returns <code>Nothing</code> or not</li>
</ul>
</li>
<li>Bind takes a function that returns a context, and can therefore can determine more about the result of the overall expression
<ul>
<li>It knows if it's going to return <code>Nothing</code></li>
</ul>
</li>
</ul>
<h2 id="do-notation"><a class="header" href="#do-notation"><code>do</code> Notation</a></h2>
<p>Notice the pattern of <code>&gt;&gt;=</code> being used with lambdas a fair amount. This can be tidied up with some nice syntactic sugar, called <code>do</code> notation. Rewriting the earlier example:</p>
<pre><code class="language-haskell">eval :: Expr -&gt; Maybe Int
eval (Val n)   = return n
eval (Add l r) = do
    x &lt;- eval l
    y &lt;- eval r
    return (x+y)
eval (Div l r) = do
    x &lt;- eval l
    y &lt;- eval r
    x `safediv` y
</code></pre>
<p>This looks like imperative code, but is actually using monads behind the scenes. The arrows bind the results of the evaluation to some local definition, which can then be referred to further down the block.</p>
<ul>
<li>A block must always end with a function call that returns a monad -
<ul>
<li>usually <code>return</code>, but <code>safediv</code> is used too</li>
</ul>
</li>
<li>If any of the calls within the <code>do</code> block shown returns <code>Nothing</code>, the entire block will short-circuit to a <code>Nothing</code>.</li>
</ul>
<h2 id="example-the-writer-monad"><a class="header" href="#example-the-writer-monad">Example: The <code>Writer</code> Monad</a></h2>
<p>The example of <code>Writer</code> as an <a href="./cs141/applicatives#example-logging">applicative</a> instance can be extended to make it a <code>Monad</code> instance.</p>
<pre><code class="language-haskell">data Writer w a = MkWriter (a,w)

instance Functor (Writer w) where
  -- fmap :: (a -&gt; b) -&gt; Writer w a -&gt; Writer w b
  fmap f (MkWriter (x,o)) = MkWriter(f x, o)

instance Monoid w =&gt; Applicative (Writer w) where
  -- pure :: Monoid w =&gt; a -&gt; Writer w a
  pure x = MkWriter (x, mempty)
  -- &lt;*&gt; :: Monoid w =&gt; Writer w (a -&gt; b) -&gt; Writer w a -&gt; Writer w b
  MkWriter (f,o1) &lt;*&gt; MkWriter (x,o2) = MkWriter (f x, o1 &lt;&gt; o2)

instance Monoid w =&gt; Monad (Writer w) where
  -- return :: Monoid w =&gt; a -&gt; Writer w a
  return = MkWriter (x, mempty) --pure
  (Writer (x, o1)) &gt;&gt;= f = MkWriter (y, o2 &lt;&gt; o1)
                          where (MkWriter (y,o2)) = f x
</code></pre>
<p>Bind for <code>Writer</code> applies the function to the <code>x</code> value in the writer, then combines the two attached written values, and return the new value from the result of <code>f x</code> along with the combined values.</p>
<p>Now we have a monad instance for the <code>Writer</code> monad, we can rewrite our <code>comp</code> function with <code>do</code> notation:</p>
<pre><code class="language-haskell">comp' :: Expr -&gt; Writer [String] Program
comp' (Val n)    = do
                   writeLog &quot;compiling a value&quot;
                   pure [PUSH n]
comp' (Plus l r) = do writeLog &quot;compiling a plus&quot;
                   pl &lt;- comp l
                   pr &lt;- comp r
                   pure (pl ++ pr ++ [ADD])
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../cs141/applicatives.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../cs141/tlp.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../cs141/applicatives.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../cs141/tlp.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
