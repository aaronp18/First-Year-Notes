<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Type-Level Programming - Computer Systems Engineering Notes</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item "><a href="../cs118/index.html"><strong aria-hidden="true">1.</strong> CS118</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs118/floats.html"><strong aria-hidden="true">1.1.</strong> IEEE 754</a></li><li class="chapter-item "><a href="../cs118/oop.html"><strong aria-hidden="true">1.2.</strong> OOP Principles</a></li><li class="chapter-item "><a href="../cs118/exceptions.html"><strong aria-hidden="true">1.3.</strong> Java Exceptions &amp; Generics</a></li></ol></li><li class="chapter-item "><a href="../cs126/index.html"><strong aria-hidden="true">2.</strong> CS126</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs126/arrays.html"><strong aria-hidden="true">2.1.</strong> Arrays &amp; Linked Lists</a></li><li class="chapter-item "><a href="../cs126/analysis.html"><strong aria-hidden="true">2.2.</strong> Analysis of Algorithms</a></li><li class="chapter-item "><a href="../cs126/recursion.html"><strong aria-hidden="true">2.3.</strong> Recursive Algorithms</a></li><li class="chapter-item "><a href="../cs126/stacks.html"><strong aria-hidden="true">2.4.</strong> Stacks &amp; Queues</a></li><li class="chapter-item "><a href="../cs126/lists.html"><strong aria-hidden="true">2.5.</strong> Lists</a></li><li class="chapter-item "><a href="../cs126/maps.html"><strong aria-hidden="true">2.6.</strong> Maps</a></li><li class="chapter-item "><a href="../cs126/hash.html"><strong aria-hidden="true">2.7.</strong> Hash Tables</a></li><li class="chapter-item "><a href="../cs126/sets.html"><strong aria-hidden="true">2.8.</strong> Sets</a></li><li class="chapter-item "><a href="../cs126/trees.html"><strong aria-hidden="true">2.9.</strong> Trees</a></li><li class="chapter-item "><a href="../cs126/pqs.html"><strong aria-hidden="true">2.10.</strong> Priority Queues</a></li><li class="chapter-item "><a href="../cs126/heaps.html"><strong aria-hidden="true">2.11.</strong> Heaps</a></li><li class="chapter-item "><a href="../cs126/skip-lists.html"><strong aria-hidden="true">2.12.</strong> Skip Lists</a></li><li class="chapter-item "><a href="../cs126/graphs.html"><strong aria-hidden="true">2.13.</strong> Graphs</a></li></ol></li><li class="chapter-item "><a href="../cs132/index.html"><strong aria-hidden="true">3.</strong> CS132</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs132/logic.html"><strong aria-hidden="true">3.1.</strong> Digital Logic</a></li><li class="chapter-item "><a href="../cs132/assembly.html"><strong aria-hidden="true">3.2.</strong> Assembly</a></li><li class="chapter-item "><a href="../cs132/memory.html"><strong aria-hidden="true">3.3.</strong> Memory Systems</a></li><li class="chapter-item "><a href="../cs132/io.html"><strong aria-hidden="true">3.4.</strong> I/O</a></li><li class="chapter-item "><a href="../cs132/architecture.html"><strong aria-hidden="true">3.5.</strong> Microprocessor Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="../cs141/index.html"><strong aria-hidden="true">4.</strong> CS141</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cs141/types.html"><strong aria-hidden="true">4.1.</strong> Types &amp; Typeclasses</a></li><li class="chapter-item "><a href="../cs141/recursion.html"><strong aria-hidden="true">4.2.</strong> Recursion</a></li><li class="chapter-item "><a href="../cs141/functions.html"><strong aria-hidden="true">4.3.</strong> Higher Order Functions</a></li><li class="chapter-item "><a href="../cs141/lazy.html"><strong aria-hidden="true">4.4.</strong> Lazy Evaluation</a></li><li class="chapter-item "><a href="../cs141/reasoning.html"><strong aria-hidden="true">4.5.</strong> Reasoning About Programs</a></li><li class="chapter-item "><a href="../cs141/functors.html"><strong aria-hidden="true">4.6.</strong> Functors &amp; Foldables</a></li><li class="chapter-item "><a href="../cs141/applicatives.html"><strong aria-hidden="true">4.7.</strong> Applicative Functors</a></li><li class="chapter-item "><a href="../cs141/monads.html"><strong aria-hidden="true">4.8.</strong> Monads</a></li><li class="chapter-item expanded "><a href="../cs141/tlp.html" class="active"><strong aria-hidden="true">4.9.</strong> Type-Level Programming</a></li></ol></li><li class="chapter-item "><a href="../es191/index.html"><strong aria-hidden="true">5.</strong> ES191</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es191/symbols-and-conventions.html"><strong aria-hidden="true">5.1.</strong> Circuit Symbols &amp; Conventions</a></li><li class="chapter-item "><a href="../es191/nodal.html"><strong aria-hidden="true">5.2.</strong> Nodal Analysis</a></li><li class="chapter-item "><a href="../es191/mesh.html"><strong aria-hidden="true">5.3.</strong> Mesh Analysis</a></li><li class="chapter-item "><a href="../es191/thevenin.html"><strong aria-hidden="true">5.4.</strong> Thevenin Circuits</a></li><li class="chapter-item "><a href="../es191/rc.html"><strong aria-hidden="true">5.5.</strong> First Order RC Circuits</a></li><li class="chapter-item "><a href="../es191/rl.html"><strong aria-hidden="true">5.6.</strong> First Order RL Circuits</a></li><li class="chapter-item "><a href="../es191/ac.html"><strong aria-hidden="true">5.7.</strong> AC Circuits</a></li><li class="chapter-item "><a href="../es191/diodes.html"><strong aria-hidden="true">5.8.</strong> Diodes</a></li><li class="chapter-item "><a href="../es191/transistors.html"><strong aria-hidden="true">5.9.</strong> Transistors</a></li><li class="chapter-item "><a href="../es191/opamps.html"><strong aria-hidden="true">5.10.</strong> Op Amps</a></li><li class="chapter-item "><a href="../es191/filters.html"><strong aria-hidden="true">5.11.</strong> Passive Filters</a></li><li class="chapter-item "><a href="../es191/equations.html"><strong aria-hidden="true">5.12.</strong> Equation Reference</a></li></ol></li><li class="chapter-item "><a href="../es193/index.html"><strong aria-hidden="true">6.</strong> ES193</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es193/functions.html"><strong aria-hidden="true">6.1.</strong> Functions, Conics &amp; Asymptotes</a></li><li class="chapter-item "><a href="../es193/complex.html"><strong aria-hidden="true">6.2.</strong> Complex Numbers</a></li><li class="chapter-item "><a href="../es193/vectors.html"><strong aria-hidden="true">6.3.</strong> Vectors</a></li><li class="chapter-item "><a href="../es193/matrices.html"><strong aria-hidden="true">6.4.</strong> Matrices</a></li><li class="chapter-item "><a href="../es193/equations.html"><strong aria-hidden="true">6.5.</strong> Simultaneous Linear Equations</a></li><li class="chapter-item "><a href="../es193/diff.html"><strong aria-hidden="true">6.6.</strong> Differentiation</a></li><li class="chapter-item "><a href="../es193/int.html"><strong aria-hidden="true">6.7.</strong> Integration</a></li><li class="chapter-item "><a href="../es193/diffeq.html"><strong aria-hidden="true">6.8.</strong> Differential Equations</a></li><li class="chapter-item "><a href="../es193/laplace.html"><strong aria-hidden="true">6.9.</strong> Laplace Transforms</a></li><li class="chapter-item "><a href="../es193/stats.html"><strong aria-hidden="true">6.10.</strong> Probability &amp; Statistics</a></li><li class="chapter-item "><a href="../es193/equationref.html"><strong aria-hidden="true">6.11.</strong> Equation Reference</a></li></ol></li><li class="chapter-item "><a href="../es197/index.html"><strong aria-hidden="true">7.</strong> ES197</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es197/mech1.html"><strong aria-hidden="true">7.1.</strong> Translational Mechanical Systems</a></li><li class="chapter-item "><a href="../es197/mech2.html"><strong aria-hidden="true">7.2.</strong> Rotational Mechanical Systems</a></li><li class="chapter-item "><a href="../es197/electrical.html"><strong aria-hidden="true">7.3.</strong> Electrical Systems</a></li><li class="chapter-item "><a href="../es197/thermal.html"><strong aria-hidden="true">7.4.</strong> Thermal Systems</a></li><li class="chapter-item "><a href="../es197/data.html"><strong aria-hidden="true">7.5.</strong> Data Driven Models</a></li><li class="chapter-item "><a href="../es197/step1.html"><strong aria-hidden="true">7.6.</strong> First Order Step Response</a></li><li class="chapter-item "><a href="../es197/step2.html"><strong aria-hidden="true">7.7.</strong> Second Order Step Response</a></li><li class="chapter-item "><a href="../es197/transfer.html"><strong aria-hidden="true">7.8.</strong> Transfer Functions</a></li><li class="chapter-item "><a href="../es197/freq1.html"><strong aria-hidden="true">7.9.</strong> First Order Frequency Response</a></li><li class="chapter-item "><a href="../es197/freq2.html"><strong aria-hidden="true">7.10.</strong> Second Order Frequency Response</a></li></ol></li><li class="chapter-item "><a href="../es2c6/index.html"><strong aria-hidden="true">8.</strong> ES2C6</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2c6/control.html"><strong aria-hidden="true">8.1.</strong> Control Systems</a></li><li class="chapter-item "><a href="../es2c6/mechanics.html"><strong aria-hidden="true">8.2.</strong> Drive Systems</a></li><li class="chapter-item "><a href="../es2c6/sensors.html"><strong aria-hidden="true">8.3.</strong> Sensors</a></li><li class="chapter-item "><a href="../es2c6/electromagnetics.html"><strong aria-hidden="true">8.4.</strong> Electromagnetics</a></li><li class="chapter-item "><a href="../es2c6/motors.html"><strong aria-hidden="true">8.5.</strong> Motor Control</a></li><li class="chapter-item "><a href="../es2c6/ac.html"><strong aria-hidden="true">8.6.</strong> AC Circuits</a></li><li class="chapter-item "><a href="../es2c6/3phase.html"><strong aria-hidden="true">8.7.</strong> Three Phase AC Power</a></li></ol></li><li class="chapter-item "><a href="../es2c7/index.html"><strong aria-hidden="true">9.</strong> ES2C7</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../es2c7/binomial.html"><strong aria-hidden="true">9.1.</strong> Binomial Theorem &amp; Taylor Series</a></li><li class="chapter-item "><a href="../es2c7/matrices.html"><strong aria-hidden="true">9.2.</strong> Matrices &amp; Quadratic Forms</a></li><li class="chapter-item "><a href="../es2c7/equations.html"><strong aria-hidden="true">9.3.</strong> Linear Simultaneous Equations</a></li><li class="chapter-item "><a href="../es2c7/eigen.html"><strong aria-hidden="true">9.4.</strong> Eigenvalues &amp; Eigenvectors</a></li><li class="chapter-item "><a href="../es2c7/systems.html"><strong aria-hidden="true">9.5.</strong> Oscillators &amp; State Space Systems</a></li><li class="chapter-item "><a href="../es2c7/calculus.html"><strong aria-hidden="true">9.6.</strong> Matrix Differential Calculus</a></li><li class="chapter-item "><a href="../es2c7/optimisation.html"><strong aria-hidden="true">9.7.</strong> Optimisation</a></li><li class="chapter-item "><a href="../es2c7/fourier.html"><strong aria-hidden="true">9.8.</strong> Fourier Series &amp; Transforms</a></li><li class="chapter-item "><a href="../es2c7/z.html"><strong aria-hidden="true">9.9.</strong> Z Transforms</a></li><li class="chapter-item "><a href="../es2c7/pdes.html"><strong aria-hidden="true">9.10.</strong> Partial Differential Equations</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Computer Systems Engineering Notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Joeyh021/first-year-notes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="type-level-programming"><a class="header" href="#type-level-programming">Type Level Programming</a></h1>
<p>Type level programming is about encoding more information in our types, so make them more descriptive. The more descriptive types are, the easier it is to avoid runtime errors, as the type checker can do more at compile time.</p>
<p>The GHC language extensions used here are:</p>
<ul>
<li><code>-XDataKinds</code></li>
<li><code>-XGATDs</code></li>
<li><code>-XKindSignatures</code></li>
<li><code>-XScopedTypeVariables</code></li>
<li><code>-XTypeFamilies</code></li>
</ul>
<h2 id="type-promotion"><a class="header" href="#type-promotion">Type Promotion</a></h2>
<p>As we already know, types have kinds:</p>
<ul>
<li><code>Bool :: *</code></li>
<li><code>Maybe :: * -&gt; *</code></li>
<li><code>[] :: * -&gt; *</code></li>
<li><code>State :: * -&gt; * -&gt; *</code></li>
</ul>
<p>Also recall that we have to partially apply type constructors with kinds greater than <code>* -&gt; *</code> to use them as monads:</p>
<pre><code class="language-haskell">-- Maybe :: * -&gt; *
instance Monad Maybe where
    ...

-- State :: * -&gt; * -&gt; *
instance Monad (State s) where
    ...

-- Either :: * -&gt; * -&gt; *
instance Monad Either where
    ... -- type error

instance Monad (Either e) where
    ... -- works
</code></pre>
<p><strong>Type Promotion</strong> is used to define our own kinds. The DataKinds extension allows for this. Without DataKinds, <code>data Bool = True | False</code> gives us two constructors, <code>True</code> and <code>False</code>. At the three levels in haskell:</p>
<ul>
<li>At the kind-level: <code>*</code></li>
<li>At the type-level <code>Bool</code></li>
<li>At the value-level: <code>True</code> or <code>False</code></li>
</ul>
<p>With DataKinds, we also get the following two new types, both of kind <code>Bool</code>:</p>
<ul>
<li><code>'True :: Bool</code></li>
<li><code>'False :: Bool</code></li>
</ul>
<p>The value constructors <code>True</code> and <code>False</code> have been promoted to the type level as <code>'True</code> and <code>'False</code>. A new kind is introduced too, <code>Bool</code> instead of just <code>*</code>. We now have booleans at the type level.</p>
<p><strong>DataKinds promotes all value constructors to type constructors, and all type constructors to kinds.</strong></p>
<p>Another example, recursively defined natural numbers. <code>Zero</code> is 0, and <code>Succ Nat</code> is <code>Nat + 1</code>.</p>
<pre><code class="language-haskell">data Nat = Zero | Succ Nat

-- values :: types
Zero :: Nat
Succ :: Nat -&gt; Nat

-- types :: kinds
'Zero :: Nat
'Succ :: Nat -&gt; Nat
</code></pre>
<h2 id="generalised-algebraic-data-types"><a class="header" href="#generalised-algebraic-data-types">Generalised Algebraic Data Types</a></h2>
<p>GADTs allow for more expressive type definitions. Normal ADT syntax:</p>
<pre><code class="language-haskell">data Bool = True | False
-- gives two values
True :: Bool
False :: Bool
</code></pre>
<p>Usually, we define the type and its values, which yields two value constructors. With a GADT, we explicitly specify the type of each data constructor:</p>
<pre><code class="language-haskell">data Bool where
  True :: Bool
  False :: Bool

data Nat where
  Zero :: Nat
  Succ :: Nat -&gt; Nat
</code></pre>
<p>The example below defines a recursively defined <code>Vector</code> type.</p>
<pre><code class="language-haskell">-- Normally
data Vector a = Nil | Cons a (Vector a)

-- GADT
data Vector a where
  Nil  :: Vector a
  Cons :: a -&gt; Vector a -&gt; Vector a
</code></pre>
<h2 id="example-a-safe-vector"><a class="header" href="#example-a-safe-vector">Example: A Safe Vector</a></h2>
<p>The vector definition above can use another feature, called KindSignatures, to put more detail into the type of the GADT definition:</p>
<pre><code class="language-haskell">data Vector (n :: Nat) a where
  Nil :: Vector n a
  Cons :: a -&gt; Vector n a -&gt; Vector n a
</code></pre>
<p>This definition includes an <code>n</code> to encode the size of the vector in the type. <code>n</code> is a type of kind <code>Nat</code>, as defined above. The values and types were promoted using DataKinds. The type variable <code>n</code> can also be replaced with concrete types:</p>
<pre><code class="language-haskell">data Vector (n :: Nat) a where
  Nil :: Vector `Zero a
  Cons :: a -&gt; Vector n a -&gt; Vector (`Succ n) a

-- example
cakemix :: Vector ('Succ ('Succ Zero)) String
cakemix = Cons &quot;Fish-Shaped rhubarb&quot; (Cons &quot;4 large eggs&quot; Nil)
</code></pre>
<p>This further constrains the types to make the types more expressive. Now we have the length of the list expressed at type level, we can define a safer version of the head function that rejects zero-length lists at compile time.</p>
<pre><code class="language-haskell">vhead :: Vector ('Succ n) a -&gt; a
-- this case will throw an error at compile time as it doesn't make sense
vhead Nil = undefined
vhead (Cons x xs) = x
</code></pre>
<p>Can also define a zip function for the vector type that forces inputs to be of the same length. The type variable <code>n</code> tells the compiler in the type signature that both vectors should have the same length.</p>
<pre><code class="language-haskell">vzip :: Vector n a -&gt; Vector n b -&gt; Vector n (a,b)
vzip Nil Nil = Nil
vzip (Cons x xs) (Cons y ys) = Cons (x,y) (vzip xs ys)
</code></pre>
<h2 id="singleton-types"><a class="header" href="#singleton-types">Singleton types</a></h2>
<p>Singletons are types with a 1:1 correspondence between types and values. Every type has only a single value constructor. The following GADT is a singleton type for natural numbers. The <code>(n :: Nat)</code> in the type definition annotates the type with it's corresponding value at type level. The type is parametrised over <code>n</code>, where <code>n</code> is the value of the type, at type level.</p>
<pre><code class="language-haskell">data SNat (n :: Nat) where
    SZero :: SNat 'Zero
    SSucc :: Snat n -&gt; SNat ('Succ n)

-- there is only one value of type SNat 'Zero
szero :: SNat 'Zero
szero = SZero

-- singleton value for one and it's type
sone :: SNat ('Succ 'Zero)
sone = SSucc SZero

stwo :: SNat ('Succ ('Succ Zero))
sone = SSucc sone
</code></pre>
<p><strong>There is only one value of each type</strong>. The data is stored at both the value and type level.</p>
<p>This can be used to define a replicate function for the vector:</p>
<pre><code class="language-haskell">vreplicate :: SNat n -&gt; a -&gt; Vector n a
vreplicate SZero x = Nil
vreplicate (SSucc n) x = Cons x (vreplicate n x)
</code></pre>
<p>The length of the vector we want is <code>SNat n</code> at type level, which is a singleton type. This allows us to be sure that the vector we are outputting is the same size as what we told it, making sure this type checks.</p>
<h2 id="proxy-types--reification"><a class="header" href="#proxy-types--reification">Proxy Types &amp; Reification</a></h2>
<p>We are storing data at the type level, which allows us to access the data at compile time and statically check it. If we want to access that data at runtime, for example to find the length of a vector, we need a <em>proxy type</em>. Proxy types allow for turning type level data to values, ie turning a type level natural number (<code>Nat</code>) into an <code>Int</code>. Haskell has no types at runtime (due to type erasure), so proxies are a hack around this.</p>
<pre><code class="language-haskell">-- a type NatProxy parametrised over some type a of kind Nat
data NatProxy (a :: Nat) = MkProxy
-- NatProxy :: Nat -&gt; *
-- MkProxy :: NatProxy a
</code></pre>
<p>This proxy type is parametrised over some value of type <code>a</code> with kind <code>Nat</code>, but there is never actually any values of type <code>a</code> involved, the info is at the type level. <code>a</code> is a phantom type.</p>
<pre><code class="language-haskell">zeroProxy :: NatProxy 'Zero
zeroProxy = MkProxy

oneProxy :: NatProxy ('Succ 'Zero)
oneProxy = MkProxy
</code></pre>
<p>These two proxies have the same value, but different types. The <code>Nat</code> type is in the phantom type <code>a</code> at type level.</p>
<p>We can then define a type class, called <code>FromNat</code>, that is parametrised over some type <code>n</code> of kind <code>Nat</code>:</p>
<pre><code class="language-haskell">class FromNat (n :: Nat) where
  fromNat :: NatProxy n -&gt; Int
</code></pre>
<p>The function <code>fromNat</code> takes a <code>NatProxy</code>, our proxy type, and converts it to an int. Instances can be defined for the two types of <code>Nat</code> to allow us to covert the type level <code>Nat</code>s to <code>Int</code>s.</p>
<pre><code class="language-haskell">-- instance for 'Zero
instance FromNat 'Zero where
  -- fromNat :: NatProxy 'Zero -&gt; int
  fromNat _ = 0

instance FromNat n =&gt; FromNat ('Succ n) where
    fromNat _ = 1 + fromNat (MkProxy :: NatProxy n)
</code></pre>
<p>The arguments to these functions are irrelevant, as the info is in the types. The variable <code>n</code> refers to the same type variable as in the instance head, using scoped type variables. This hack allows for passing types to functions using proxies, and the converting them to values using reification.</p>
<h2 id="type-families"><a class="header" href="#type-families">Type Families</a></h2>
<p>Type families allow for performing computation at the type level. A type family can be defined to allow addition of two type-level natural numbers:</p>
<pre><code class="language-haskell">type family Add (n :: Nat) (m :: Nat) :: Nat where
  Add 'Zero m = m
  Add ('Succ n) m = 'Succ (Add n m)

-- alternatively
type family (n :: Nat) + (m :: Nat) :: Nat where
  'Zero   + m = m
  'Succ n + m = 'Succ (n + m)
</code></pre>
<p>The type family for <code>(+)</code> is whats known as a closed type family: once it's defined it cannot be redfined or added to. This type family can be used to define an append function for our vector:</p>
<pre><code class="language-haskell">vappend :: Vector n a -&gt; Vector m a -&gt; Vector (n+m) a
vappend Nil         ys = ys
vappend (Cons x xs) ys = Cons x (vappend xs ys)
</code></pre>
<p>Importing <code>GHC.TypeLits</code> allows for the use of integer literals at type level instead of writing out long recursive type definitions for <code>Nat</code>. This means we can now do:</p>
<pre><code class="language-haskell">data Vector (n :: Nat) a where
  Nil :: Vector 0 a
  Cons :: a -&gt; Vector n a -&gt; Vector (n+1) a

vappend Nil          Nil          :: Vector 0 a
vappend (Cons 4 Nil) Nil          :: Vector 1 Int
vappend (Cons 4 Nil) (Cons 8 Nil) :: Vector 2 Int
</code></pre>
<h3 id="associated-open-type-families"><a class="header" href="#associated-open-type-families">Associated (Open) Type Families</a></h3>
<p>The definition below defines a typeclass for a general collection of items:</p>
<pre><code class="language-haskell">class Collection c where
  empty :: c a
  insert :: a -&gt; c a -&gt; c a
  member :: a -&gt; c a -&gt; Bool

instance Collection [] where
  empty = []
  insert x xs = x : xs
  member x xs = x `elem` xs
</code></pre>
<p>However, the list instance will throw an error, as <code>elem</code> has an <code>Eq</code> constraint on it, while the <code>member</code> type from the typeclass doesn't. Another example, defining the red-black tree as an instance of <code>Collection</code> (the tree is defined in one of the lab sheets):</p>
<pre><code class="language-haskell">instance Collection Tree where
  empty = empty
  insert x t = insert t x
  member x t = member x t
</code></pre>
<p>This will raise two type errors, as both <code>insert</code> and <code>member</code> for the tree need <code>Ord</code> constraints, which <code>Collection</code> doesn't have.</p>
<p>To fix this, we can attach an associated type family to a type class.</p>
<pre><code class="language-haskell">class Collection c where
  type family Elem c :: *

  empty :: c
  insert :: a -&gt; c -&gt; c
  member :: a -&gt; c -&gt; Bool
</code></pre>
<p>For an instance of <code>Collection</code> for some type <code>c</code>, we must also define a case for c for a type level function <code>Elem</code>, this establishing a relation between <code>c</code> and some type of kind <code>*</code>.</p>
<p>We can now define instance for list and tree, where <code>Eq</code> and <code>Ord</code> constraints are placed in instance definition.</p>
<pre><code class="language-haskell">instance Eq a =&gt; Collection [a] where
    type Elem [a] = a

    empty = []
    insert x xs = x : xs
    member x xs = x `elem` xs


instance Ord a =&gt; Collection (L.Tree a) where
    type Elem (L.Tree a) = a

    empty      = L.Leaf
    insert x t = L.insert t x
    member x t = L.member x t
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../cs141/monads.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../es191/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../cs141/monads.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../es191/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
